generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum ExpenseStatus {
  pending
  approved
  rejected
}

model Room {
  id         String     @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  inviteCode String     @unique
  roommates  Roommate[]
  expenses   Expense[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

model Roommate {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  email            String?
  password         String?
  isManager        Boolean   @default(false)
  roomId           String    @db.ObjectId
  room             Room      @relation(fields: [roomId], references: [id])
  expensesAdded    Expense[] @relation("ExpensesAdded")
  expensesApproved Expense[] @relation("ExpensesApproved")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([roomId])
}

model Expense {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  description  String
  amount       Float
  category     String
  date         DateTime
  status       ExpenseStatus @default(pending)
  roomId       String        @db.ObjectId
  room         Room          @relation(fields: [roomId], references: [id])
  addedById    String        @db.ObjectId
  addedBy      Roommate      @relation("ExpensesAdded", fields: [addedById], references: [id])
  approvedById String?       @db.ObjectId
  approvedBy   Roommate?     @relation("ExpensesApproved", fields: [approvedById], references: [id])
  approvedAt   DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@index([roomId])
}
